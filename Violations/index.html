<!DOCTYPE html>

    <html>

        <head>
            

            <meta charset="utf-8">
            <meta name="viewport" content="width=device-width">
             
            <title>ARI Violations</title>
            
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

            <!--Add Leaflet CSS-->
            <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
            <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
            <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin=""></script>
            
            <!--KVS geoJSON-->    
            <script src="violations.geojson"></script>
            <script src="AlcRelatedCrashes"></script>
            <script src="OnOutletCluster"></script>
            <script src="OffOutletCluster"></script>
            
            <div class="navbar">
                <a href="https://aripublicsciencecollaborative.github.io/Dashboard/">Home</a>
                <a href="https://aripublicsciencecollaborative.github.io/Dashboard/Sales/">Sales</a>
                <a href="https://aripublicsciencecollaborative.github.io/Dashboard/Violations/">Violations</a>
                <a href="https://aripublicsciencecollaborative.github.io/Dashboard/Health/">Health & Safety</a>
                <a href="https://aripublicsciencecollaborative.github.io/Dashboard/Tobacco/">Tobacco</a>
                <a href="https://aripublicsciencecollaborative.github.io/Dashboard/Executive/">Click Here to Learn More</a>
            </div>

              

            <!--Boot Strap-->
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">

            <script src = "Leaflet.SvgShapeMarkers-gh-pages/dist/leaflet-svg-shape-markers.min.js"></script>
              

     
                <style>
 
                  
                    h1 {text-align: center; font-size: 50px}
                    h2 {text-align: center; margin-left: 10px}
                    h3 {text-align: left; margin-left:auto;border-left:auto; padding: 5px}
                    h4 {text-align: center; margin-left:auto;border-left:auto; margin-left: 10px; font-size: 20px}
                    h5 {text-align: left; margin-left:auto;border-left:auto; margin-left: 10px; margin-right: 10px;font-size: 22px}
                    h6 {text-align: left; margin-left:auto;border-left:auto; margin-left: 15px; font-size: 20px}


                    .center {
                    display: block;
                    margin-left: auto;
                    margin-right: auto;
                    width: 25%;
                    } 


                    #map1container {border: 1px solid#0a0a0a; position:absolute; background-color:#ecf7fc; color:black; text-align:left; margin-right: 5px; margin-left:5px; width:600px; height:800px;padding 0; }
                    #map1 {border: 1px solid#0a0a0a; position:relative;  margin-left: 600px; width:1250px; height:800px; padding 0; overflow:hidden;}

                     /* The navigation bar */
                     .navbar {
                    overflow: hidden;
                    background-color: #333;
                    position: relative; /* Set the navbar to fixed position */
                    top: 0; /* Position the navbar at the top of the page */
                    width: 100%; /* Full width */
                    }

                    /* Links inside the navbar */
                    .navbar a {
                    float: left;
                    display: block;
                    color: #f2f2f2;
                    text-align: center;
                    padding: 14px 16px;
                    text-decoration: none;
                    }

                    /* Change background on mouse-over */
                    .navbar a:hover {
                    background: #ddd;
                    color: black;
                    }

                    /* Main content */
                    .main {
                    margin-top: 30px; /* Add a top margin to avoid content overlay */
                    }
                
 /* Legend */
 .legend {
                        line-height: 18px;
                        color: #555;
                        background color:cornsilk
                        }
                    .legend i {
                        width: 20px;
                        height: 20px;
                        float: left;
                        margin-right: 8px;
                        opacity: 0.7;
                        }
                    .info {
                        padding: 6px 8px;
                        font: 20px/20px Arial, Helvetica, sans-serif;
                        background: white;
                        background: rgba(255,255,255,0.8);
                        box-shadow: 0 0 15px rgba(0,0,0,0.2);
                        border-radius: 5px;
                        }
                    .info h4 {
                        margin: 0 0 5px;
                        color: #777;
                        }
                        
                    .legend .circle {
                        border-radius: 50%;
                        width: 10px;
                        height: 10px;
                        margin-top: 8px;
                        }

                    .legend .triangle {
                        border-radius: 50%;
                        width: 10px;
                        height: 10px;
                        margin-top: 8px;
                        }
                </style>
        
        </head>

    <body>   
           
       
        <!--Title-->
       
       
   <!--       <img src="ARI.jpg" height=30% width=30% > -->           
   <img src= "IAIP.png">                                                                   
   <img src="logonew.jpg" height=20% width=20% margin-right=100px >
  
       
        <h4><b>Violations among Alcohol Establishments, 2008-2019</b> </h4>
   
            </div>
            <div id='map1container'> <h5><b>Background: </b> The Alcoholic Beverages Division (ABD) is responsible for the licensing of establishment for the production and sale of alcohol in the state. Additionally, the ABD is responsible for oversight of licensed alcohol establishments to ensure compliance with liquor laws, such as selling alcohol to minors. </h5>
                <h5><b> Map: </b>The map to the right was designed to help the Alcoholic Beverages Division, communities, and public health agencies identify the locations of alcohol establishment violations recorded by ABD compliance officers. Red dots identify violations involving the sale of alcohol to a minor (42% of all violations) and grey dots identify all other violations. The map also includes information on the locations of alcohol outlet clusters, which are a known environmental health risk. </h5>
                <h5><b>Interactivity: </b>Click on the map layer feature in the top right corner of the map to see a list of map elements. The map allows users to view statewide alcohol violations by year. Check the squares to see violations for one or more years. Check or uncheck the squares for alcohol outlet clusters and alcohol-related car crashes. Use the buttons on the top left of the map to zoom in or out. Click on any of the circles to see learn more about the violation. </h5>
                <h5><b>Definitions: </b>Alcohol outlet clusters are defined as five or more outlets within .15 miles of at least one other outlet in the cluster. On-premise outlets refer to establishments that sell alcohol on-site, such as restaurants, bars, and taverns. Off-premise outlets are licensed to sell alcohol for off-premise consumption and include gas stations, grocery stores, and liquor stores. </h5>
                </div>
        <div id='map1' class="center"></div>
        <h6><b>Sources:</b> 
    <br>            Iowa Alcoholic Beverages Division, Alcohol Licenses Dataset, 2019
    <br>        Iowa Alcoholic Beverages Division, Alcohol Violations Dataset, 2008-2019
    <br>       Iowa Department of Transportation, Drug/Alcohol Related Crashes, 2019
            
            <br>
  

 
        <script>   
                  
                //Violations Data Map 
                var map1 = L.map('map1').setView([42.1, -93.5], 8);
                        L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors',
                        maxZoom: 18,
                        id: 'mapbox/streets-v11',
                        accessToken: 'pk.eyJ1Ijoia3ZhbnNlbG91cyIsImEiOiJjazZsbHE2NGwwZDdtM2tvNmRjc2N0NHo5In0.h_W_-4R3haPMK-IDBTcL-w' 
                        }).addTo(map1);      
                
                var osmS1 = L.tileLayer('https://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://osm.org/copyright">OpenStreetMap</a> contributors',
                        maxZoom: 18
                        }).addTo(map1);


                var circle1 = {
                        radius: 4,
                        fillColor: "gray",
                        color: "black",
                        weight: 1,
                        opacity: 1,
                        fillOpacity: 0.8
                        };

                
                
                var crashes = L.geoJSON(crashes,  { 
                            filter: function(feature, layer) {
                                return feature.type == "Feature";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.shapeMarker(coordinates, {
                            color: "darkred",      
                            shape: "x",
	                    	radius: 10,
                            weight: 2
	                        });
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<br><b> Severity: </b>" + feature.properties.CSEVERITY )
                            },
                            } 
                            ).bringToFront(100);        
                
                
                var nineteen= L.geoJSON(violations, { 
                            filter: function(feature, layer) {
                                return feature.properties.year == "2019";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates,circle1);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<b>Violation Count: </b>" + feature.properties.violation_count +  
                            "<br><b>Violation: </b>"+ feature.properties.violation_name+
                            "<br><b>Year: </b>" +feature.properties.year)
                        }, style: function(feature) {
                              switch (feature.properties.violation_name) {
                                 case 'Minors': return {color: "black", fillColor: "#BE030B"};
                            }
                        }}).addTo(map1);


                
                var eighteen= L.geoJSON(violations, { 
                            filter: function(feature, layer) {
                                return feature.properties.year == "2018";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates,circle1);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<b>Violation Count: </b>" + feature.properties.violation_count +  
                            "<br><b>Violation: </b>"+ feature.properties.violation_name+
                            "<br><b>Year: </b>" +feature.properties.year 
                            )
                        }, style: function(feature) {
                              switch (feature.properties.violation_name) {
                                 case 'Minors': return {color: "black", fillColor: "#BE030B"};
                            }
                        }}).addTo(map1);
                
                var seventeen=  L.geoJSON(violations, { 
                            filter: function(feature, layer) {
                                return feature.properties.year == "2017";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates,circle1);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<b>Violation Count: </b>" + feature.properties.violation_count +  
                            "<br><b>Violation: </b>"+ feature.properties.violation_name+
                            "<br><b>Year: </b>" +feature.properties.year 
                            )
                        }, style: function(feature) {
                              switch (feature.properties.violation_name) {
                                 case 'Minors': return {color: "black", fillColor: "#BE030B"};
                            }
                        }}).addTo(map1);
                     
                var sixteen=  L.geoJSON(violations, { 
                            filter: function(feature, layer) {
                                return feature.properties.year == "2016";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates,circle1);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<b>Violation Count: </b>" + feature.properties.violation_count +  
                            "<br><b>Violation: </b>"+ feature.properties.violation_name+
                            "<br><b>Year: </b>" +feature.properties.year 
                            )
                        }, style: function(feature) {
                              switch (feature.properties.violation_name) {
                                 case 'Minors': return {color: "black", fillColor: "#BE030B"};
                            }
                        }}).addTo(map1);
                
                 var fifteen=  L.geoJSON(violations, { 
                            filter: function(feature, layer) {
                                return feature.properties.year == "2015";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates,circle1);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<b>Violation Count: </b>" + feature.properties.violation_count +  
                            "<br><b>Violation: </b>"+ feature.properties.violation_name+
                            "<br><b>Year: </b>" +feature.properties.year
                            )
                        }, style: function(feature) {
                              switch (feature.properties.violation_name) {
                                 case 'Minors': return {color: "black", fillColor: "#BE030B"};
                            }
                        }}).addTo(map1);
                
                 var fourteen =  L.geoJSON(violations, { 
                            filter: function(feature, layer) {
                                return feature.properties.year == "2014";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates,circle1);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<b>Violation Count: </b>" + feature.properties.violation_count +  
                            "<br><b>Violation: </b>"+ feature.properties.violation_name+
                            "<br><b>Year: </b>" +feature.properties.year )
                        }, style: function(feature) {
                              switch (feature.properties.violation_name) {
                                 case 'Minors': return {color: "black", fillColor: "#BE030B"};
                            }
                        }}).addTo(map1);

                var thirteen=  L.geoJSON(violations, { 
                            filter: function(feature, layer) {
                                return feature.properties.year == "2013";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates,circle1);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<b>Violation Count: </b>" + feature.properties.violation_count +  
                            "<br><b>Violation: </b>"+ feature.properties.violation_name+
                            "<br><b>Year: </b>" +feature.properties.year )
                        }, style: function(feature) {
                              switch (feature.properties.violation_name) {
                                 case 'Minors': return {color: "black", fillColor: "#BE030B"};
                            }
                        }}).addTo(map1);
                
                var twelve=  L.geoJSON(violations, { 
                            filter: function(feature, layer) {
                                return feature.properties.year == "2012";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates,circle1);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<b>Violation Count: </b>" + feature.properties.violation_count +  
                            "<br><b>Violation: </b>"+ feature.properties.violation_name+
                            "<br><b>Year: </b>" +feature.properties.year )
                        }, style: function(feature) {
                              switch (feature.properties.violation_name) {
                                 case 'Minors': return {color: "black", fillColor: "#BE030B"};
                            }
                        }}).addTo(map1);
                
                var eleven=  L.geoJSON(violations, { 
                            filter: function(feature, layer) {
                                return feature.properties.year == "2011";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates,circle1);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<b>Violation Count: </b>" + feature.properties.violation_count +  
                            "<br><b>Violation: </b>"+ feature.properties.violation_name+
                            "<br><b>Year: </b>" +feature.properties.year )
                        }, style: function(feature) {
                              switch (feature.properties.violation_name) {
                                 case 'Minors': return {color: "black", fillColor: "#BE030B"};
                            }
                        }}).addTo(map1);

                var ten=  L.geoJSON(violations, { 
                            filter: function(feature, layer) {
                                return feature.properties.year == "2010";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates,circle1);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<b>Violation Count: </b>" + feature.properties.violation_count +  
                            "<br><b>Violation: </b>"+ feature.properties.violation_name+
                            "<br><b>Year: </b>" +feature.properties.year )
                        }, style: function(feature) {
                              switch (feature.properties.violation_name) {
                                 case 'Minors': return {color: "black", fillColor: "#BE030B"};
                            }
                        }}).addTo(map1);

                var nine =  L.geoJSON(violations, { 
                            filter: function(feature, layer) {
                                return feature.properties.year == "2009";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates,circle1);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<b>Violation Count: </b>" + feature.properties.violation_count +  
                            "<br><b>Violation: </b>"+ feature.properties.violation_name+
                            "<br><b>Year: </b>" +feature.properties.year )
                        }, style: function(feature) {
                              switch (feature.properties.violation_name) {
                                 case 'Minors': return {color: "black", fillColor: "#BE030B"};
                            }
                        }}).addTo(map1);

                var eight=  L.geoJSON(violations, { 
                            filter: function(feature, layer) {
                                return feature.properties.year == "2008";
                            },
                            pointToLayer: function(feature, coordinates) {
                            return L.circleMarker(coordinates,circle1);
                            },
                            onEachFeature: function (feature, layer) {
                            popupOptions = {maxWidth: 200}; 
                            layer.bindPopup("<b>Violation Count: </b>" + feature.properties.violation_count +  
                            "<br><b>Violation: </b>"+ feature.properties.violation_name+
                            "<br><b>Year: </b>" +feature.properties.year )
                        }, style: function(feature) {
                              switch (feature.properties.violation_name) {
                                 case 'Minors': return {color: "black", fillColor: "#BE030B"};
                            }
                        }}).addTo(map1);

                        function styleOn(feature) {
                            return {
                                fillColor: 'darkgreen',
                                weight: 3,
                                opacity: 1,
                                radius: 10, 
                                color: 'darkgreen',
                                fillOpacity: 0.2
                            };
                        }

                        function styleOff(feature) {
                            return {
                                fillColor: 'darkblue',
                                weight: 3,
                                opacity: 1,
                                color: 'darkblue',
                                fillOpacity: 0.2
                            };
                        }


                var OnClusters =  L.geoJson(onoutletcluster, {style: styleOn})
                var OffClusters =  L.geoJson(offoutletcluster, {style: styleOff})
               
                var basemapS1 = {
                    "Open Street Map" : osmS1,
                };
                var overlayMaps1 = {
                        "2019 Violations": nineteen,
                        "2018 Violations": eighteen,
                        "2017 Violations": seventeen,
                        "2016 Violations": sixteen,
                        "2015 Violations": fifteen,
                        "2014 Violations": fourteen,
                        "2013 Violations": thirteen,
                        "2012 Violations": twelve,
                        "2011 Violations": eleven,
                        "2010 Violations": ten,
                        "2009 Violations": nine,
                        "2008 Violations": eight,
                        "Alcohol Outlet Clusters, On-Premise": OnClusters,
                        "Alcohol Outlet Clusters, Off-Premise": OffClusters,
                        "Alcohol-Related Automobile Crashes": crashes
                        };			

                    L.control.layers(basemapS1, overlayMaps1).addTo(map1);	


                    var legend1 = L.control({position: 'bottomleft'}); 
                        legend1.onAdd = function (map1) {
                            var div = L.DomUtil.create('div', 'info legend');
                            grades = [" Violations Involving Minors", " All Other Violations"],
                            labels = ["minorMarker.png", "violationMarker.png",];
                            for (var i = 0; i < grades.length; i++) {
                              div.innerHTML +=
                              (" <img src="+ labels[i] +" height='10' width='10'>") + grades[i] +'<br>';
                                }

                         return div;
                        } ;
                        legend1.addTo(map1)

                </script>
        
    </body>
    
</html>
